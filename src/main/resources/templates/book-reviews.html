<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />

        <title>Book Reviews</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap CSS CDN -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" th:href="@{/css/user-menu.css}">
        <link rel="stylesheet" th:href="@{/css/animations.css}"/>

    </head>
    <body class="bg-light">

        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom mb-4 px-3">
            <a class="navbar-brand" href="#">ðŸ“š BookZone</a>
            <div class="ms-auto">
                <div class="user-menu" th:if="${loggedInUserName != null}">
                    <button class="btn btn-outline-secondary" id="userToggleBtn">
                        Hello, <span th:text="${loggedInUserName}">User</span> â–¼
                    </button>
                    <div class="user-menu-content" id="userMenu">
                        <form th:action="@{/reviewer-dashboard}">
                            <button type="submit" class="text-muted">Profile</button>
                        </form>
                        <form th:action="@{/logout}" method="post">
                            <button type="submit" class="text-danger">Logout</button>
                        </form>
                    </div>
                </div>

                <div th:if="${loggedInUserName == null}">
                    <a id="loginBtn" class="btn btn-outline-primary me-2"
                       th:href="@{/login}">Login</a>
                    <!--            <a class="btn btn-primary" href="/register">Sign Up</a>&ndash;&gt;-->
                </div>


            </div>
        </nav>



        <div class="container mt-5">
            <h2 th:text="${bookTitle}"></h2>

            <hr>

            <!-- Reviews -->
            <div class="mb-4">
                <h4>Reviews</h4>
                <div class="list-group" id="reviewList">
                    <!-- Dynamically inserted reviews go here -->
                    <div class="list-group">
                        <div th:each="review : ${reviews}" class="list-group-item list-group-item-action">
                            <p th:text="${review.comment}" class="mb-1"></p>
                            <small th:text="'Posted by ' + ${review.reviewer.fullName} + ' on ' + ${review.createdAtFormatted}"></small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add New Review -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Add a Review</h5>

                    <form id="reviewForm" th:data-bookId="${bookId}">
                        <!-- Comment -->
                        <div class="mb-3">
                            <label for="comment" class="form-label">Comment</label>
                            <textarea id="comment" name="comment" class="form-control" rows="3" required></textarea>
                        </div>

                        <!-- Submit -->

                        <input type="hidden" name="loggedInUserFullName" th:value="${loggedInUserName}" >
                        <button type="submit" class="btn btn-primary">Post Review</button>
                        <div id="youMustLoginDiv" class="alert alert-danger mt-3" style="display: none">
                            You must log in to post a comment.
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <!-- JavaScript -->
        <script th:src="@{/js/scripts.js}"></script>
    </body>
</html>
